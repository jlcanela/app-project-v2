# UI Layout Specification: Schema & Rule Editor

## Technology Stack
- **Framework:** React
- **UI Library:** Mantine v7
- **Rule Engine UI:** GoRules JDM (React Component)

## 1. Global Application Shell
The application utilizes Mantine's `AppShell` to provide a persistent structure.

### Layout Structure
```tsx
<AppShell
  header={{ height: 60 }}
  navbar={{ width: 280, breakpoint: 'sm', collapsed: { mobile: !opened } }}
  padding="md"
>
  <AppShell.Header>...</AppShell.Header>
  <AppShell.Navbar>...</AppShell.Navbar>
  <AppShell.Main>...</AppShell.Main>
</AppShell>
```

### Header
- **Left:** Branding ("Rule Studio") & Breadcrumbs (e.g., `Catalog > CartState`).
- **Right:**
  - **Environment Badge:** (DEV / STAGING / PROD).
  - **User Profile:** Avatar with menu.
  - **Theme Toggle:** Dark/Light mode (essential for complex graph editing).

### Navbar (Sidebar)
Organized into collapsible sections using `NavLink` components:
1.  **Dashboard**
2.  **Domain Catalog** (The "IN" building blocks)
    *   States
    *   Events
    *   Entities
3.  **Rule Definitions**
    *   **Rule Types** (The "OUT" Contracts & Capabilities)
    *   **Rule Instances** (The Logic / JDM Files)
4.  **Governance**
    *   Version History
    *   Access Control

---

## 2. Key View Layouts

### A. Domain Catalog (Schema Editor)
**Layout Pattern:** Master-Detail with Drawer.
- **List View:** `MantineReactTable` displaying schemas with columns for Name, Version, and Tags.
- **Detail View (Drawer):**
    - Opens from the right (`position="right"`, `size="xl"`).
    - **Tabs:** "Visual Editor", "JSON Schema", "Usage References".
    - **Visual Editor:** A tree-based builder to add fields/types without writing raw code.

### B. Rule Type Configuration (Contract Definition)
**Layout Pattern:** Split Pane (Grid with 2 Columns).
- **Left Pane (Input Context):**
    - **Selector:** `MultiSelect` to pick States/Entities from the Catalog.
    - **Preview:** Read-only JSON view of the aggregated `RuleInput` schema.
- **Right Pane (Output Capabilities):**
    - **Result Definition:** Form to define the pure result type.
    - **Capability Matrix:** A list of `Card` components representing Action Types (`UpdateState`, `TriggerEvent`).
    - **Configuration:** Inside each card, a `MultiSelect` allows whitelisting specific States/Events (e.g., "Only allow updates to `CartState`").

### C. Rule Logic Editor (GoRules Integration)
**Layout Pattern:** Full-Screen Workspace.
- **Top Bar:**
    - Rule Name & Version.
    - **Actions:** "Save", "Validate", "Simulate".
- **Main Area:**
    - Embeds the **GoRules JDM Component**.
    - Configured to fill available height/width (`flex: 1`).
- **Right Sidebar (Context Helper):**
    - A collapsible `Aside` or floating panel.
    - **Input Variables:** A searchable tree of the `RuleInput` schema (provides field names for the JDM expression language).
    - **Allowed Actions:** A reference list of what this rule is *allowed* to return (based on the Rule Type).

### D. Simulator
**Layout Pattern:** Two-Column Grid.
- **Column 1 (Input):**
    - **Form:** Auto-generated form (using `@rjsf/mantine`) based on the rule's Input Schema.
    - **Presets:** Dropdown to load saved test scenarios.
- **Column 2 (Output):**
    - **Result Card:** Displays the pure calculation result.
    - **Effects Timeline:** A vertical timeline component showing the side-effects generated by the rule.
        - *Green Node:* State Updates.
        - *Blue Node:* Events Triggered.

## 3. Theme & Styling
- **Colors:** Use a professional palette (e.g., Mantine's `blue` or `indigo` primary).
- **Typography:** Monospace fonts for Schema definitions and Expression editors.
- **Spacing:** Compact spacing in the Editor views to maximize visibility of the Decision Graph.